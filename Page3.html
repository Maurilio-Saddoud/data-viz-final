<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Alata&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <title>Final Project</title>
  </head>
  <body>
    <div class="page-container">
      <div class="title-container">
        <h1>Ethnic Diversity of Schools in Each Region</h1>
      </div>
      <div class="nav-buttons-container">
        <button onclick="directToPage2()">Prev page</button>
        <button onclick="directToHome()">Home</button>
        <button onclick="directToPage4()">Next page</button>
      </div>
      <div class="p-container">
        <p>
          Below you can see a star chart that has several characteristics on it.
          The green line represents the average cost of a 4-year degree broken
          down into seven regions. the other lines represent various ethnic
          groups within the US broken down into their percentage of the regions
          average college attendance by said ethnic group. The largest and most
          notable group would be those of European decent represented by the
          grey line. As you can see white college students are the majority of
          the four-year degree program participants in every region during the
          year 2020. The Blue and Purple groups represent African American and
          Latino Americans respectively.
        </p>
      </div>
      <div class="svg-container"></div>
      <div class="p-container follow-up">
        <p>
          An interesting relationship seems to be developing between college
          cost and representation. As cost goes up the relative diversity
          amongst student bodies goes down. We believe this is due to the fact
          that college cost is a larger barrier to those from marginalized and
          low-income communities.
        </p>
      </div>
      <div class="nav-buttons-container follow-up">
        <button onclick="directToPage2()">Prev page</button>
        <button onclick="directToHome()">Home</button>
        <button onclick="directToPage4()">Next page</button>
      </div>
    </div>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>

    <script>
      const directToHome = () => {
        document.location.href = "index.html";
      };
      const directToPage2 = () => {
        document.location.href = "Page2.html";
      };
      const directToPage4 = () => {
        document.location.href = "Page4.html";
      };
      var parseTime = d3.timeParse("%Y");

      raw_data = d3.csv("raw_data.csv").then((raw_data) => {
        console.log(raw_data);

        raw_data.map((d) => {
          if (
            d.State == "Connecticut" ||
            d.State == "Maine" ||
            d.State == "Massachusetts" ||
            d.State == "New Hampshire" ||
            d.State == "Rhode Island" ||
            d.State == "Vermont"
          ) {
            d.Region = "New England";
          } else if (
            d.State == "New York" ||
            d.State == "New Jersey" ||
            d.State == "Delaware" ||
            d.State == "Maryland" ||
            d.State == "Pennsylvania"
          ) {
            d.Region = "Mid-Atlantic";
          } else if (
            d.State == "West Virginia" ||
            d.State == "Virginia" ||
            d.State == "Kentucky" ||
            d.State == "Tennessee" ||
            d.State == "Arkansas" ||
            d.State == "Tennessee" ||
            d.State == "North Carolina" ||
            d.State == "South Carolina" ||
            d.State == "Mississippi" ||
            d.State == "Georgia" ||
            d.State == "Alabama" ||
            d.State == "Louisiana" ||
            d.State == "Florida"
          ) {
            d.Region = "Southeast";
          } else if (
            d.State == "North Dakota" ||
            d.State == "South Dakota" ||
            d.State == "Nebraska" ||
            d.State == "Kansas" ||
            d.State == "Minnesota" ||
            d.State == "Iowa" ||
            d.State == "Missouri" ||
            d.State == "Wisconsin" ||
            d.State == "Illinois" ||
            d.State == "Michigan" ||
            d.State == "Indiana" ||
            d.State == "Ohio"
          ) {
            d.Region = "Midwest";
          } else if (
            d.State == "Montana" ||
            d.State == "Idaho" ||
            d.State == "Nevada" ||
            d.State == "Wyoming" ||
            d.State == "Utah" ||
            d.State == "Colorado"
          ) {
            d.Region = "Rocky Mountains";
          } else if (
            d.State == "Arizona" ||
            d.State == "Texas" ||
            d.State == "New Mexico" ||
            d.State == "Oklahoma"
          ) {
            d.Region = "Southwest";
          } else d.Region = "Pacific Costal";
        });

        console.log(raw_data);

        data = d3.csv("data.csv").then((data) => {
          data.forEach((d) => {
            d.date = parseTime(d.Year);
            d.value = +d["Value"];
          });

          // Filter out 2-year institutions and expenses that include room and board

          data = data.filter(
            (d) =>
              d.Length === "4-year" &&
              d.Expense === "Fees/Tuition" &&
              d.Year === "2020"
          );

          // Sort states into regions so our data isn't comparing apples to oranges

          data.map((d) => {
            if (
              d.State == "Connecticut" ||
              d.State == "Maine" ||
              d.State == "Massachusetts" ||
              d.State == "New Hampshire" ||
              d.State == "Rhode Island" ||
              d.State == "Vermont"
            ) {
              d.Region = "New England";
            } else if (
              d.State == "New York" ||
              d.State == "New Jersey" ||
              d.State == "Delaware" ||
              d.State == "Maryland" ||
              d.State == "Pennsylvania" ||
              d.State == "District of Columbia"
            ) {
              d.Region = "Mid-Atlantic";
            } else if (
              d.State == "West Virginia" ||
              d.State == "Virginia" ||
              d.State == "Kentucky" ||
              d.State == "Tennessee" ||
              d.State == "Arkansas" ||
              d.State == "Tennessee" ||
              d.State == "North Carolina" ||
              d.State == "South Carolina" ||
              d.State == "Georgia" ||
              d.State == "Alabama" ||
              d.State == "Mississippi" ||
              d.State == "Louisiana" ||
              d.State == "Florida"
            ) {
              d.Region = "Southeast";
            } else if (
              d.State == "North Dakota" ||
              d.State == "South Dakota" ||
              d.State == "Nebraska" ||
              d.State == "Kansas" ||
              d.State == "Minnesota" ||
              d.State == "Iowa" ||
              d.State == "Missouri" ||
              d.State == "Wisconsin" ||
              d.State == "Illinois" ||
              d.State == "Michigan" ||
              d.State == "Indiana" ||
              d.State == "Ohio"
            ) {
              d.Region = "Midwest";
            } else if (
              d.State == "Montana" ||
              d.State == "Idaho" ||
              d.State == "Nevada" ||
              d.State == "Wyoming" ||
              d.State == "Utah" ||
              d.State == "Colorado"
            ) {
              d.Region = "Rocky Mountains";
            } else if (
              d.State == "Arizona" ||
              d.State == "Texas" ||
              d.State == "New Mexico" ||
              d.State == "Oklahoma"
            ) {
              d.Region = "Southwest";
            } else d.Region = "Pacific Costal";
          });

          raw_data = d3
            .nest()
            .key((d) => d.Region)
            .rollup((v) => {
              return {
                mean_white: d3.mean(v, (d) => d.white),
                mean_black: d3.mean(v, (d) => d.black),
                mean_hispanic: d3.mean(v, (d) => d.hispanic),
                mean_asian: d3.mean(v, (d) => d.asian),
                mean_native: d3.mean(v, (d) => d.nativePeople),
                mean_polynesian: d3.mean(v, (d) => d.polynesian),
                mean_mr: d3.mean(v, (d) => d.MR),
              };
            })
            .entries(raw_data);

          console.log(raw_data);

          data = d3
            .nest()
            .key((d) => d.Region)
            .key((d) => d.Year)
            .rollup((v) => {
              return {
                date: v[0].date,
                mean: d3.mean(v, (d) => d.value),
              };
            })
            .entries(data);

          console.log(data);

          let data_path = [];
          let features = ["SE", "PC", "SW", "RM", "NE", "MA", "MW"];

          // generate the data
          var e = 0;
          console.log(data[1].values[0].value.mean);

          for (let i = 0; i < 8; i++) {
            var point = {};
            if (i == 0) {
              features.forEach(function (f, j) {
                point[f] = (data[j].values[0].value.mean / 40000) * 10;
              });
              data_path.push(point);
            } else if (i == 1) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.mean_white * 10;
              });
              data_path.push(point);
            } else if (i == 2) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.mean_black * 10;
              });
              data_path.push(point);
            } else if (i == 3) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.mean_hispanic * 10;
              });
              data_path.push(point);
            } else if (i == 4) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.mean_asian * 10;
              });
              data_path.push(point);
            } else if (i == 5) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.nativePeople * 10;
              });
              data_path.push(point);
            } else if (i == 6) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.mean_polynesian * 10;
              });
              data_path.push(point);
            } else if (i == 7) {
              features.forEach(function (f, j) {
                point[f] = raw_data[j].value.mean_mr * 10;
              });
              data_path.push(point);
            }
          }

          console.log(data_path);

          let width = 900;
          let height = 600;

          let svg = d3
            .select(".svg-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

          let radialScale = d3.scaleLinear().domain([0, 10]).range([0, 250]);

          let ticks = [2, 4, 6, 8, 10];

          svg
            .selectAll("circle")
            .data(ticks)
            .join((enter) =>
              enter
                .append("circle")
                .attr("cx", width / 2)
                .attr("cy", height / 2)
                .attr("fill", "none")
                .attr("stroke", "gray")
                .attr("r", (d) => radialScale(d))
            );

          svg
            .selectAll(".ticklabel")
            .data(ticks)
            .join((enter) =>
              enter
                .append("text")
                .attr("class", "ticklabel")
                .attr("x", width / 2 + 5)
                .attr("y", (d) => height / 2 - radialScale(d))
            );

          function angleToCoordinate(angle, value) {
            let x = Math.cos(angle) * radialScale(value);
            let y = Math.sin(angle) * radialScale(value);
            return { x: width / 2 + x, y: height / 2 - y };
          }

          let featureData = features.map((f, i) => {
            let angle = Math.PI / 2 + (2 * Math.PI * i) / features.length;
            return {
              name: f,
              angle: angle,
              line_coord: angleToCoordinate(angle, 10),
              label_coord: angleToCoordinate(angle, 10.5),
            };
          });

          // draw axis line
          svg
            .selectAll("line")
            .data(featureData)
            .join((enter) =>
              enter
                .append("line")
                .attr("x1", width / 2)
                .attr("y1", height / 2)
                .attr("x2", (d) => d.line_coord.x)
                .attr("y2", (d) => d.line_coord.y)
                .attr("stroke", "black")
            );

          // draw axis label
          svg
            .selectAll(".axislabel")
            .data(featureData)
            .join((enter) =>
              enter
                .append("text")
                .attr("x", (d) => d.label_coord.x)
                .attr("y", (d) => d.label_coord.y)
                .text((d) => d.name)
            );

          let line = d3
            .line()
            .x((d) => d.x)
            .y((d) => d.y);

          let colors = [
            "green",
            "grey",
            "blue",
            "purple",
            "black",
            "orange",
            "cyan",
            "brown",
          ];

          function getPathCoordinates(data_point) {
            let coordinates = [];
            for (var i = 0; i < features.length; i++) {
              let ft_name = features[i];
              let angle = Math.PI / 2 + (2 * Math.PI * i) / features.length;
              coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
            }
            let ft_name = features[0];
            let angle = Math.PI / 2 + (2 * Math.PI * i) / features.length;
            coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
            return coordinates;
          }

          // draw the path element
          svg
            .selectAll("path")
            .data(data_path)
            .join((enter) =>
              enter
                .append("path")
                .datum((d) => getPathCoordinates(d))
                .attr("d", line)
                .attr("stroke-width", 3)
                .attr("stroke", (_, i) => colors[i])
                .attr("fill", "none")
                .attr("stroke-opacity", 1)
                .attr("opacity", 0.5)
            );

          //How big the legand box is
          var legendBox = 140;

          // draw legend
          var legend = svg
            .selectAll(".legend")
            .data(data)
            .enter()
            .append("g")
            .attr("class", "legend")
            .attr("transform", function (d, i) {
              return "translate(0," + i * 20 + ")";
            })
            .on("mouseover", function () {
              //mouse over functions to fade
              d3.select(this)
                .select("rect")
                .style("stroke", (d) => z(d.key))
                .style("opacity", 0.5);
            })
            .on("mouseout", function () {
              //leave opaque when not mousing over
              d3.select(this)
                .select("rect")
                .style("stroke", "none")
                .style("opacity", 1.0);
            })
            .on("click", function (d) {
              //when click
              county.style("stroke-width", 2).style("stroke-opacity", 1);

              county
                .filter((e) => e.key !== d.key) //filter unclicked lines
                .style("stroke-width", 1)
                .style("stroke-opacity", 0.1);
            });

          // draw legend colored rectangles
          legend
            .append("rect")
            .attr("x", width + 10)
            .attr("y", margin.top)
            .attr("rx", 5)
            .attr("width", legendBox)
            .attr("height", 20)
            .style("fill", (d) => z(d.key));

          // draw legend text
          legend
            .append("text")
            .attr("x", width + 10 + legendBox / 2)
            .attr("y", margin.top + 9)
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .style("pointer-events", "none")
            .text((d) => d.key);
        });
      });
    </script>
    <style>
      .nav-buttons-container {
        display: flex;
        width: 960px;
        justify-content: space-between;
      }
      button {
        padding: 10px;
        font-family: "Alata", sans-serif;
        font-size: 20px;
      }
      body {
        font-family: "Alata", sans-serif;
      }
      .img-container {
        width: 100%;
        display: flex;
        justify-content: center;
        margin: 30px 0px 20px 0px;
      }
      .p-container {
        width: 960px;
        margin-bottom: 20px;
      }

      .follow-up {
        margin-top: 20px;
      }

      .caption {
        color: grey;
        margin-bottom: -5px;
        font-size: 14px;
      }

      .bar-chart {
        border: solid 1px black;
        background-color: rgb(255, 255, 255);
      }
      .bar {
        fill: rgb(140, 140, 140);
      }
      .label {
        font-size: 9pt;
      }
      .category {
        text-anchor: end;
      }
      .title-container {
        width: 960px;
        text-align: center;
      }
      .page-container {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
      }
    </style>
  </body>
</html>
